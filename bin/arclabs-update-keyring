#!/bin/bash

# Ensure we have the arclabs-keyring and it's populated
if arclabs-pkg-missing arclabs-keyring || ! sudo pacman-key --list-keys 40DFB630FF42BCFFB047046CF0134EE680CAC571 &>/dev/null; then
  sudo pacman-key --recv-keys 40DFB630FF42BCFFB047046CF0134EE680CAC571 --keyserver keys.openpgp.org
  sudo pacman-key --lsign-key 40DFB630FF42BCFFB047046CF0134EE680CAC571

  # This is generally not a good idea, but this is a special case because we're going to be updating
  # the full set of packages in arclabs-update-system-pkgs right after this (and it needs latest keyring)!
  sudo pacman -Sy
  arclabs-pkg-add arclabs-keyring

  sudo pacman-key --list-keys 40DFB630FF42BCFFB047046CF0134EE680CAC571
fi
